<!DOCTYPE html>
<html>
<head><title>SƠ ĐỒ LỚP ĐIỆN TỬ</title></head>
<body>
<canvas id="sodolop" width="1000" height="900" style="border:1px solid #000000;">
Sorry, your browser does not support canvas.
</canvas>
<script>
const canvas = document.getElementById("sodolop");
const ctx = canvas.getContext("2d");
let banhocList = [];
let sttthanhvien = {};
let vitringoi = {};

function vebanhoc(x,y){
  const bx = 30 + (220*(x-1));
  const by = 30 + (120*(y-1));
  const bw = 200;
  const bh = 100;
  ctx.strokeRect(bx, by, bw, bh);
  ctx.beginPath();
  ctx.moveTo(bx + bw/2, by);
  ctx.lineTo(bx + bw/2, by + bh);
  ctx.stroke();
  banhocList.push({x: x+"A", y: y, bx: bx, by: by, bw: bw/2, bh: bh});
  banhocList.push({x: x+"B", y: y, bx: bx+bw/2, by: by, bw: bw/2, bh: bh});
}
function veTen(){
  ctx.font = "14px Arial";
  ctx.fillStyle = "blue";
  for (let key in vitringoi.blocks){
    const [ix, iy] = key.split(",").map(Number);
    const block = vitringoi.blocks[key];
    for (let side of ["A","B"]){
      const stt = block[side];
      if (stt && sttthanhvien[stt]){
        const ban = banhocList.find(b=> b.x===ix+side && b.y===iy);
        if(ban){
          ctx.fillText(sttthanhvien[stt].name, ban.bx+5, ban.by+20);
        }
      }
    }
  }
}
async function loadData(){
  const res1 = await fetch("https://12a02.palat.io.vn/data/source/user_admin/data.json");
  const res2 = await fetch("https://12a02.palat.io.vn/data/source/user_admin/xepchongoi.json");
  const data = await res1.json();
  vitringoi = await res2.json();
  sttthanhvien = {};
  data.forEach(s => sttthanhvien[s.stt] = s);
  veTen();
}

loadData();

for(let i=1;i<=4;i++){
  for(let m=1;m<=6;m++){
    vebanhoc(i,m,1);
  }
}
vebanhoc(4.3,7.2,0);
canvas.addEventListener("click", function(e){
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  for (let ban of banhocList){
    if(mouseX >= ban.bx && mouseX <= ban.bx+ban.bw &&
       mouseY >= ban.by && mouseY <= ban.by+ban.bh){
      alert(ban.x+", "+ban.y);
      break;
    }
  }
});
</script>
</body>
</html>
